@{
    Layout = null;
}
@*分段按15分钟收费*@
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<link href="~/Content/bootstrap-timepicker.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap-theme.css" rel="stylesheet" />
<link href="~/Content/font-awesome.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/bootstrap-timepicker.min.js"></script>
<script src="~/Scripts/common.js"></script>
<style>
    .textAlignRight {
        text-align: right;
    }

    .h30 {
        height: 30px;
        margin-bottom: 10px;
        line-height: 30px;
        color: #6C7A8B;
    }
    label, select {
        color: #6C7A8B;
    }

    .input-group-addon {
        background-color: #E8F6FF;
        border: 1px solid #E7E9ED;
        color: #6C7A8B;
    }

    input.form-control {
        border: 1px solid #E7E9ED;
        color: #0092FF;
        text-align: center;
    }

    .panel {
        border-radius: 0px;
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
    }

    input[type="number"] {
        -moz-appearance: textfield;
    }
</style>
<form id="form" method="post" action="#" onsubmit="parent.SaveBtn();return false;">
    <div style="height:0;overflow: hidden;"><input type="submit" value="submit" /></div>
    <div style="margin-left:30px;width:100%;overflow:auto;height:100vh">
        <div id="" style="margin-left:20px">
            <input id="TemplateModelName" value="TemplateModelName" class="hidden" />
            <div class="panel panel-primary" style="margin:0px -20px; border-color: #e7e9ed;">
                <div style="color: #6C7A8B; background-color: #f3f8fb; border-color: #e7e9ed;">
                    <label style="margin-left:10px;margin-top:5px;font-size:12px">公共设置</label>
                </div>
                <div class="panel-body" style="padding-bottom:10px;padding-top:10px;">
                    <!--公共设置-->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">白天时段</label>
                                <div class="col-md-5 input-group">
                                    <div class="bootstrap-timepicker timepicker">
                                        <input id="DayBeginTime" type="text" class="form-control datetimepicker3" data-theme="DayBeginTime" name="DayBeginTime" value="" style="height:30px;width:70px">
                                    </div>
                                    <span class="input-group-addon" style="font-size:12px;height:26px">至</span>
                                    <div class="bootstrap-timepicker timepicker">
                                        <input id="DayEndTime" type="text" class="form-control datetimepicker3" data-theme="DayEndTime" name="DayEndTime" value="" style="height:30px;width:70px">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">每天最高收费</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" name="DayTopLimit" id="DayTopLimit" class="form-control NumText input-sm MaxNumText required" min="0" max="65535" value="65535">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">白天最高收费</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" class="form-control NumText MaxNumText input-sm required" name="DayMaxMoney" id="DayMaxMoney" min="0" max="65535" value="65535">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">离场超时时间</label>
                                <div class="col-md-5 input-group">
                                    <input class="form-control required MaxNumHaxText NumText input-sm" type="number" min="0" max="65535" id="LeaveTimeout" name="LeaveTimeout" value="30">
                                    <span class="input-group-addon">分</span>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-6">
                            <div class="form-group validateinput h30">
                                <label class="col-md-4 control-label textAlignRight">计费单位</label>
                                <div class="col-md-8 radio-list">
                                    <label class="radio-inline">
                                        <input name="MonetaryUnit" id="Unit1" value="1" type="radio" onclick="Sect1Money.change()" checked><span style="font-size:12px">元</span>
                                    </label>
                                    <label class="radio-inline">
                                        <input name="MonetaryUnit" id="Unit2" value="0" type="radio" onclick="Sect1Money.change()"> <span style="font-size:12px">角</span>
                                    </label>
                                    <label class="radio-inline">
                                        <input name="MonetaryUnit" id="Unit3" value="2" type="radio" onclick="Sect1Money.change()"> <span style="font-size:12px">分</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">本次最高收费</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" name="AmountTopLimit" id="AmountTopLimit" class="form-control NumText input-sm MaxNumText required" min="0" max="65535" value="65535">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">晚上最高收费</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" class="form-control NumText MaxNumText input-sm required" name="NightMaxMoney" id="NightMaxMoney" min="0" max="65535" value="255">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <div class="col-md-2">
                                </div>
                                <div class="col-md-10">
                                    <span id="SpFeeSet1">
                                        <input type="checkbox" class="input-small " id="FeeSet1" name="FeeSet1" value="" onclick="Sect1Money.FeeSet1Checked()">
                                    </span>
                                    <label class="font-size-12">无分段，按白天段处理</label>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group validateinput text-align-center" style="padding-top:3px;padding-left:6px;">
                            <div class="col-md-1"></div>
                            <div class="col-md-4">
                                <select class="selectpicker" data-style="selectorinite" data-width="auto" name="FeeSet2" id="FeeSet2" style="height:30px;">
                                    <option id="0" class="font-size-12 height-28" value="0">只有一个免费分钟(填写白天段免费分钟)</option>
                                    <option id="1" class="font-size-12 height-28" value="1">白天段和晚上段都有免费分钟</option>
                                </select>
                            </div>
                            <div class="col-md-2"></div>
                            <div class="col-md-4">
                                <select class="selectpicker" data-style="selectorinite" data-width="auto" name="FeeSet3" id="FeeSet3" style="height:30px;">
                                    <option id="0" class="font-size-12 height-28" value="0">计算时不去掉免费分钟</option>
                                    <option id="1" class="font-size-12 height-28" value="1">计算时去掉免费分钟在计算</option>
                                </select>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group validateinput text-align-center" style="padding-top:3px;padding-left:6px;">
                            <div class="col-md-1"></div>

                            <div class="col-md-4">
                                <select class="selectpicker" data-style="selectorinite" data-width="auto" name="FeeSet9" id="FeeSet9" style="height:30px;">
                                    <option id="0" class="font-size-12 height-28" value="0">收费金额精确到角</option>
                                    <option id="1" class="font-size-12 height-28" value="1">收费金额精确到元</option>
                                    <option id="2" class="font-size-12 height-28" value="2">收费金额精确到分</option>
                                </select>
                            </div>
                            <div class="col-md-2"></div>

                            <div class="col-md-4">
                                <select class="selectpicker" data-style="selectorinite" data-width="auto" name="FeeSet10" id="FeeSet10" style="height:30px;">
                                    <option id="0" class="font-size-12 height-28" value="0">超时时间10进制(0-99)</option>
                                    <option id="1" class="font-size-12 height-28" value="1">超时时间16进制(0-255)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group validateinput text-align-center" style="padding-top:3px;padding-left:6px;">
                            <div class="col-md-1"></div>
                            <div class="col-md-8 padding-left-0">
                                <select class="selectpicker" data-style="selectorinite" data-width="400px" name="FeeSet4" id="FeeSet4" style="height:30px;">
                                    <option id="0" class="font-size-12 height-28" value="0">跨段时不足一天部分，如本段时间不足，则由下段补足时间</option>
                                    <option id="1" class="font-size-12 height-28" value="1">跨段时不足一天部分将两段停留时间分别计算，并将计算结果相加</option>
                                    <option id="2" class="font-size-12 height-28" value="2">无一天最高收费原则，按时间段逐段计算并累加费用</option>
                                    <option id="3" class="font-size-12 height-28" value="3">先计算N天费用，不足一天时间逐段累加</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group validateinput text-align-center" style="padding-top:3px;padding-left:35px;">
                            <div class="row">
                                <div class="col-md-1"></div>
                                <div class="col-md-8">
                                    <div class="row ">
                                        <span id="SpFeeSet7">
                                            <input type="checkbox" class="input-small " id="FeeSet7" name="FeeSet7" value="" onclick="Sect1Money.FeeSet7Checked()">
                                        </span>
                                        <label class="font-size-12">超过1天后，剩余不足1天时间白天段无前N小时收费，直接按每M个15分钟收费</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-1"></div>
                                <div class="col-md-8">
                                    <div class="row ">
                                        <span id="SpFeeSet8">
                                            <input type="checkbox" class="input-small " id="FeeSet8" name="FeeSet8" value="" onclick="Sect1Money.FeeSet8Checked()">
                                        </span>
                                        <label class="font-size-12">超过1天后，剩余不足1天时间晚上段无前N小时收费，直接按每M个15分钟收费</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-primary " style="margin: 0px -20px; border-color: #e7e9ed;">
                <div style="color: #6C7A8B; background-color: #f3f8fb; border-color: #e7e9ed;">
                    <label style="margin-left:10px;margin-top:5px;font-size:12px">白天时段内设置</label>
                </div>
                <div class="panel-body" style="padding-bottom:0px; padding-top:10px;">
                    <!--白天时段内设置-->
                    <div class="row">
                        <div class="col-md-4 padding-left-right-0">
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">免费分钟</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" name="DayFreeMinutes" id="DayFreeMinutes" class="form-control NumText MaxNumHaxText input-sm required" min="0" max="255" value="30">
                                    <span class="input-group-addon">分</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">超时时间为</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" name="DayTimeOut" id="DayTimeOut" class="form-control NumText MaxNumHaxText input-sm required" min="0" max="255" value="30">
                                    <span class="input-group-addon">分</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 padding-left-right-0">
                            <div class="form-group validateinput  h30">
                                <label class="col-md-3 control-label textAlignRight">首</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="DayFirstTime" id="DayFirstTime" min="0" max="255" value="30">
                                </div>
                                <label class="col-md-4 control-label font-size-12">个15分钟</label>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-3 control-label textAlignRight">以后</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="DayNextTime" id="DayNextTime" min="0" max="255" value="30">
                                </div>
                                <label class="col-md-4 control-label font-size-12">个15分钟</label>
                            </div>
                        </div>

                        <div class="col-md-4 padding-left-0">
                            <div class="form-group validateinput h30">
                                <label class="col-md-4 control-label textAlignRight">收费</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="DayFirstMoney" id="DayFirstMoney" min="0" max="255" value="5">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-4 control-label textAlignRight">收费</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="DayNextMoney" id="DayNextMoney" min="0" max="255" value="10">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-primary" style="margin: 0px -20px; border-color: #e7e9ed;">
                <div style="color: #6C7A8B; background-color: #f3f8fb; border-color: #e7e9ed;">
                    <label style="margin-left:10px;margin-top:5px;font-size:12px">晚上时段内设置</label>
                </div>
                <div class="panel-body" style="padding-bottom:0px;padding-top:10px;">
                    <!--晚上时段内收费设置-->
                    <div class="row">
                        <div class="col-md-4 padding-left-right-0">
                            <div class="form-group validateinput h30">
                                <label class="col-md-5 control-label textAlignRight">免费分钟</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" name="NightFreeMinutes" id="NightFreeMinutes" class="form-control NumText MaxNumHaxText input-sm required" min="0" max="255" value="30">
                                    <span class="input-group-addon">分</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30 ">
                                <label class="col-md-5 control-label textAlignRight">超时时间为</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" name="NightTimeOut" id="NightTimeOut" class="form-control NumText MaxNumDecText input-sm required" min="0" max="99" value="30">
                                    <span class="input-group-addon">分</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 padding-left-right-0">
                            <div class="form-group validateinput h30">
                                <label class="col-md-3 control-label textAlignRight">首</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="NightFirstTime" id="NightFirstTime" min="0" max="255" value="30">
                                </div>
                                <label class="col-md-4 control-label font-size-12">个15分钟</label>
                            </div>
                            <div class="form-group validateinput  h30">
                                <label class="col-md-3 control-label textAlignRight">以后</label>
                                <div class="col-md-5 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="NightNextTime" id="NightNextTime" min="0" max="255" value="30">
                                </div>
                                <label class="col-md-4 control-label font-size-12">个15分钟</label>
                            </div>
                        </div>
                        <div class="col-md-4 padding-left-0">
                            <div class="form-group validateinput h30">
                                <label class="col-md-4 control-label textAlignRight">收费</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="NightFirstMoney" id="NightFirstMoney" min="0" max="255" value="5">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                            <div class="form-group validateinput h30">
                                <label class="col-md-4 control-label textAlignRight">收费</label>
                                <div class="col-md-7 input-group">
                                    <input type="number" class="form-control NumText MaxNumHaxText input-sm required" name="NightNextMoney" id="NightNextMoney" min="0" max="255" value="10">
                                    <span class="input-group-addon classunit">元</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<script>
    var Sect1Money = function () {
        $('.datetimepicker3').timepicker({
            minuteStep: 1,
            maxHours: 24,
            showMeridian: false,
            secondStep: 1,
            showSeconds: false,
        });
        function FeeSet1Checked() {
            $("#FeeSet1").val("")
            $("#FeeSet1:checked").val("0")
        }
        function FeeSet7Checked() {
            $("#FeeSet7").val("")
            $("#FeeSet7:checked").val("0")
        }
        function FeeSet8Checked() {
            $("#FeeSet8").val("")
            $("#FeeSet8:checked").val("0")
        }
        //获取carTypeGuid
        var url = location.href
        var num = url.split("?")[1]
        var carTypeGuid = num.split("=")[1]
        $.ajax({
            url: "/Home/Maps/ParkLot/GetBillingTemplate?CarTypeGuid=" + carTypeGuid,
            dataType: 'json',
            method: 'GET',
            contentType: "application/json;charset=utf-8",
            success: function (res) {
                if (res.IsSuccess == true) {
                    //请求成功判断是新增还是修改
                    if (res.Result !== null) {
                        //修改
                        $("#form").attr("flag", "1")
                    } else {
                        //新增
                        $("#form").attr("flag", "0")
                    }
                    if (res.Result !== null) {
                        if (res.Result.ChargeMode == 10) {
                            var data = JSON.parse(res.Result.TemplateJson)
                            var MonetaryUnit = data.MonetaryUnit;
                            if ($("input[name=MonetaryUnit]").eq(0).val() == MonetaryUnit) {
                                $("input[name=MonetaryUnit]").eq(0).prop("checked", true)
                                $("input[name=MonetaryUnit]").eq(1).prop("checked", false)
                                $("input[name=MonetaryUnit]").eq(2).prop("checked", false)
                                change()
                            } else if ($("input[name=MonetaryUnit]").eq(1).val() == MonetaryUnit) {
                                $("input[name=MonetaryUnit]").eq(1).prop("checked", true)
                                $("input[name=MonetaryUnit]").eq(0).prop("checked", false)
                                $("input[name=MonetaryUnit]").eq(2).prop("checked", false)
                                change()
                            } else if ($("input[name=MonetaryUnit]").eq(2).val() == MonetaryUnit) {
                                $("input[name=MonetaryUnit]").eq(2).prop("checked", true)
                                $("input[name=MonetaryUnit]").eq(0).prop("checked", false)
                                $("input[name=MonetaryUnit]").eq(1).prop("checked", false)
                                change()
                            }
                            $("#FeeSet1").val(data.FeeSet1)
                            if (data.FeeSet1 == "0") {
                                $("#FeeSet1").prop("checked", true)
                            } else if (!data.FeeSet1) {
                                $("#FeeSet1").prop("checked", false)
                            }
                            $("#FeeSet7").val(data.FeeSet7)
                            if (data.FeeSet7 == "0") {
                                $("#FeeSet7").prop("checked", true)
                            } else if (!data.FeeSet7) {
                                $("#FeeSet7").prop("checked", false)
                            }
                            $("#FeeSet8").val(data.FeeSet8)
                            if (data.FeeSet8 == "0") {
                                $("#FeeSet8").prop("checked", true)
                            } else if (!data.FeeSet8) {
                                $("#FeeSet8").prop("checked", false)
                            }
                            $("#DayBeginTime").val(data.DayBeginTime)
                            $("#DayEndTime").val(data.DayEndTime)
                            $("#DayFreeMinutes").val(data.DayFreeMinutes)
                            $("#DayFirstTime").val(data.DayFirstTime)
                            $("#DayFirstMoney").val(data.DayFirstMoney)
                            $("#DayNextTime").val(data.DayNextTime)
                            $("#DayNextMoney").val(data.DayNextMoney)
                            $("#DayTimeOut").val(data.DayTimeOut)
                            $("#DayMaxMoney").val(data.DayMaxMoney)
                            $("#NightFreeMinutes").val(data.NightFreeMinutes)
                            $("#NightFirstTime").val(data.NightFirstTime)
                            $("#NightFirstMoney").val(data.NightFirstMoney)
                            $("#NightNextTime").val(data.NightNextTime)
                            $("#NightNextMoney").val(data.NightNextMoney)
                            $("#NightTimeOut").val(data.NightTimeOut)
                            $("#NightMaxMoney").val(data.NightMaxMoney)
                            $("#AmountTopLimit").val(data.AmountTopLimit)
                            $("#DayTopLimit").val(data.DayTopLimit)
                            $("#FeeSet2").val(data.FeeSet2)
                            $("#FeeSet3").val(data.FeeSet3)
                            $("#FeeSet4").val(data.FeeSet4)
                            $("#FeeSet5").val(data.FeeSet5)
                            $("#FeeSet6").val(data.FeeSet6)
                            $("#FeeSet9").val(data.FeeSet9)
                            $("#FeeSet10").val(data.FeeSet10)
                            $("#LeaveTimeout").val(data.LeaveTimeout)
                        }
                    }
                }

            }
        })
        function change() {
            var value = $("input[name='MonetaryUnit']:checked").parent().find("span").html();
            $(".classunit").html(value);
        }
        return {
            change: change,
            FeeSet1Checked: FeeSet1Checked,
            FeeSet7Checked: FeeSet7Checked,
            FeeSet8Checked: FeeSet8Checked
        }
    }()
</script>
